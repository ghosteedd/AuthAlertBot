# AuthAlertBot

![](https://img.shields.io/appveyor/ci/gruntjs/grunt.svg)![](https://img.shields.io/badge/platform-linux-lightgrey.svg)![](https://img.shields.io/badge/python-3.6%20%7C%203.7-blue.svg)![](https://img.shields.io/badge/version-1.2-yellow.svg)![](https://img.shields.io/badge/license-MIT-orange.svg)

## Описание

AuthAlertBot - это telegram бот предназначенный для оповещения о новых подключениях через ssh. Для получения информации о подключениях бот использует файл /var/log/auth.log. Так же с помощью данного бота можно легко блокировать/разблокировать (c помощью iptables) доступ к linux машине. Данный бот будет полезен для тех кто хочет знать о том, кто и когда подключается к его системе. Поддерживается работа в чатах для множественного доступа к оповещениям и управлению. 

## Требования

Для корректной работы требуется:
 - Python 3.6 или выше
 - iptables
 
Требуемые модули python:
 - Requests
 - PySocks

**ВНИМАНИЕ:** Для работы бота требуются права суперпользователя.

Работоспособность проверена на Ubuntu 18.04 LTS.

## Установка и настройка

### Настройка бота

Если в папке со скриптом отсутствует файл конфигурации просто запустите скрипт и следуйте указаниям. Для перенастройки бота запустите скрипт с аргументом '-setup':

    python3 AlertBot.py -setup

P.S. Если вы будите использовать несколько ботов в групповом чате **ОБЯЗАТЕЛЬНО** укажите префикс. Он будет служить идентификатором бота.

### Установка бота как демона

#### Для установки бота как демона требуется установить systemd

    apt-get install systemd

#### Далее необходимо создать файл сервиса

Расположение файла: 

    /etc/systemd/system/AuthAlertBot.service

Пример такого файла:

    [Unit]
    Description=AuthAlertBot
    After=syslog.target
    After=network.target
    
    [Service]
    Type=simple
    User=root
    WorkingDirectory=/root/AuthAlertBot
    ExecStart=/usr/bin/python3 /root/AuthAlertBot/AlertBot.py
    RestartSec=10
    Restart=always
     
    [Install]
    WantedBy=default.target

#### После создания сервиса включаем и запускаем его 

    systemctl daemon-reload
    systemctl enable AuthAlertBot
    systemctl start AuthAlertBot
    systemctl status AuthAlertBot

#### В случае успеха вы увидите следующее
![Daemon status](https://i.imgur.com/iW240Zc.jpg)

![Telegram message](https://i.imgur.com/FERTsMK.jpg)

## Команды

Доступные команды:

    /status - Состояние потоков
    /kill_bot - Отключение всех потоков бота
    /lock [prefix] X.X.X.X - Блокировка IP адреса
    /unlock [prefix] X.X.X.X - Разблокировка IP адреса

## Совместное использование

Для коллективного использования бота / ботов несколькими пользователями необходимо создать группу / супергруппу и добавить в нее бота / ботов, а так же остальных пользователей. После создания группы необходимо **изменить privacy mode** бота в состояние **disabled**. В противном случае бот не сможет получить chat_id. После выполнения данных действий можно приступить к настройке back end'а бота.

При использовании бота / ботов в группах вы можете точечно (для обработки в конкретном боте) делать блокировки / разблокировки указывая в команде 2-м аргументом префикс указанный при настройке back end'а. В ином случае команда будет выполнена всеми ботами.

**ВНИМАНИЕ:** При конвертации группы в супергруппу меняется chat_id, что требует нового сканирования chat_id.

## Защита доступа

Для защиты доступа к управлению ботом при первичной настройке необходимо отправить в чат с ботом случайно сгенерированную строку. Это необходимо для определения chat_id, иначе говоря чата который будет иметь доступ к командам бота. Все остальные чаты ботом будут игнорироваться.

Данный бот не отправляет ни какой информации его создателю и хранит все данные, необходимую для его работы, локально.

## Лицензия

AuthAlertBot - это программное обеспечение с открытым исходным кодом, лицензированное по [лицензии MIT](https://opensource.org/licenses/MIT).

(С) Nikolay Sysoev, ghosteedd, 2018.
